## redis宕机后的快速恢复机制-RDB

==***AOF记录的是操作记录， RDB记录的是当时内存中的数据***==

### RDB启用时会阻塞主线程吗

redis提供了两个命令来生成RDB文件

1. `save`
    会阻塞主线程。
2. `bgsave`
    会`fork`出子进程。不会阻塞主线程。

### RDB的优缺点

1. 优点
    快照的恢复速度快

2. 缺点
    磁盘压力大，不能频繁使用， 频率设置的太少的话，又容易丢失数据

### 混合使用 AOF 日志和内存快照

简单来说，内存快照以一定的频率执行，在两次快照之间，使用 AOF 日志记录这期间的所有命令操作。

这样一来，快照不用很频繁地执行，这就避免了频繁 fork 对主线程的影响。而且，AOF 日志也只用记录两次快照间的操作，也就是说，不需要记录所有操作了，因此，就不会出现文件过大的情况了，也可以避免重写开销。

### 关于AOF和RDB的选择问题

- 数据不能丢失时，内存快照和 AOF 的混合使用是一个很好的选择；
- 如果允许分钟级别的数据丢失，可以只使用 RDB；
- 如果只用 AOF，优先使用 everysec 的配置选项，因为它在可靠性和性能之间取了一个平衡。